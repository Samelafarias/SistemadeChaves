CODIGO CERTO

//PAGINA DE LOGIN
*HTML
*CSS
*SCRIPT
*INDEX

//PAGINA PRINCIPAL
*HTML
<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<link rel="shortcut icon" href="img/icon.png" type="image/x-icon">
<title>Controle de chaves</title>
</head>
<body >
<header class="header">
<h1 id="h1_pag_princ">Controle do Registro de Chaves</h1><!--Título da página padrão-->
</header>
<main id="main_pag_princ">
<p id="dados_line_sup">
<label for="data" class="label_pag_princ">Data:</label><!--Inserir dia-->
<input type="date" name="data" id="data" class="dados_pag_princ">    
<label for="setor" class="label_pag_princ">Setor:</label><!--Inserir sala / setor-->
<select name="setor" id="setor_pag_princ">
<option value="setor" selected>Setor</option>
<!-- opções de sala -->
<option value="01">Sala 01</option>
<option value="02">Sala 02</option>
<option value="03">Sala 03</option>
<option value="04">Sala 04</option>
<option value="05">Sala 05</option>
<option value="06">Sala 06</option>
<option value="07">Sala 07</option>
<option value="08">Sala 08</option>
<option value="09">Sala 09</option>
<option value="10">Sala 010</option>
<option value="11">Sala 011</option>
<option value="12">Sala 012</option>
<option value="13">Sala 013</option>
<option value="14">Sala 014</option>
<option value="15">Sala 015</option>
<option value="16">Sala 016</option>
<option value="17">Sala 017</option>
<option value="18">Sala 018</option>
<option value="19">Sala 019</option>
<option value="20">Sala 020</option>
</select>
</p>    
<p>
<!--selecionar a entrega ou devolução-->
<label for="operacao" class="label_pag_princ">Selecione a operação requerida:</label>
<!--fazer configuração de quando clicar mudar de cor para saber que foi selecionado-->
<button class="oper_pag_princ" id="entrega" >Entrega</button>
<button class="oper_pag_princ" id="devolucao" >Devolução</button>
</p>    
<p>
<label for="responsavel" class="label_pag_princ">Responsável:</label><!--Preeencher quem é o responsável-->
<input type="text" id="resp_pag_princ" name="responsavel">
<label for="horario" class="label_pag_princ">Horário: </label><!--Preencher o horário em que a chave foi pega/devolvida-->
<input type="time" class="dados_pag_princ" name="horario" id="horario">
</p>
<br>
<p>
<button id="bnt_registrar" value="registrar_dados" id="registrar_dados">Registrar</button><!--Para registrar a entrega ou devolução da chave-->
<br>
<button class="bnt_link_pag_principal" id="ver_chaves" onclick="abrir_pag_chave()">Ver chaves</button><!--Para ir para a página chaves-->
<br>
<button class="bnt_link_pag_principal" id="ver_registros" onclick="abrir_pag_registros()">Registros de Chaves</button><!--Para ir para a página de registros-->
</p>
</main>    
<br>
<footer></footer>
<script src="script.js" defer>
</script>
</body>
</html>

*SCRIPT
//script página principal
// script.js
async function registrar_dados() {
    const data = document.getElementById('data').value;
    const setor = document.getElementById('setor_pag_princ').value;
    const responsavel = document.getElementById('resp_pag_princ').value;
    const horario = document.getElementById('horario').value;
    const entrega = document.getElementById('entrega').classList.contains('ativo');
    const devolucao = document.getElementById('devolucao').classList.contains('ativo');

    if (!data || !setor || !responsavel || !horario || (!entrega && !devolucao)) {
        alert("Por favor, preencha todos os campos e selecione uma operação.");
        return;
    }

    const dataFormatada = new Date(data).toISOString().split('T')[0];

    const dados = {
        date: dataFormatada,
        sector: setor,
        responsible: responsavel,
        time: horario,
        operation: entrega ? 'entrega' : 'devolucao'
    };

    try {
        const response = await fetch('http://localhost:5500/pag_principal', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(dados)
        });

        if (response.ok) {
            alert("Dados registrados com sucesso!");
        } else {
            alert("Erro ao registrar dados.");
        }
    } catch (error) {
        console.error('Erro ao registrar dados:', error);
        alert('Erro ao registrar dados. Verifique se todos os campos foram preenchidos corretamente.');
    }
}

// Função para mudar a cor dos botões e aplicar a mudança em outra página
function clicar(btnClicado) {
    // Seleciona os elementos HTML dos botões
    const entrega = document.getElementById('entrega');
    const devolucao = document.getElementById('devolucao');

    // Verifica qual botão foi clicado e aplica a mudança de cor
    if (btnClicado === entrega) {
        entrega.classList.add('ativo');
        devolucao.classList.remove('ativo');
    } else if (btnClicado === devolucao) {
        devolucao.classList.add('ativo');
        entrega.classList.remove('ativo');
    }
}

// Funções para abrir as páginas
function abrir_pag_chave() {
    window.open('pag_chaves.html', '_blank');
}

function abrir_pag_registros() {
    window.open('pag_registros.html', '_blank');
}

// Adiciona os ouvintes de eventos aos botões
document.getElementById('entrega').addEventListener('click', function() {
    clicar(this);
});
document.getElementById('devolucao').addEventListener('click', function() {
    clicar(this);
});
document.getElementById('bnt_registrar').addEventListener('click', registrar_dados);

*INDEX
//API PARA PAGINA PRINCIPAL
    app.post('/pag_principal', (req, res) => {
        const newRecord = req.body;
        const query = 'INSERT INTO registros (date, setor, operacao, responsavel, time) VALUES (?, ?, ?, ?, ?)';
        const values = [newRecord.date, newRecord.sector, newRecord.operation, newRecord.responsible, newRecord.time];
      
        db.query(query, values, (err, result) => {
            if (err) {
                return res.status(500).json({ error: err.message });
            }
            res.status(201).json({ message: 'Registro criado com sucesso', id: result.insertId });
        });
      });

//PAGINA DE REGISTROS
*HTML
*CSS
*SCRIPT
*INDEX

//PAGINA DE CHAVES
*HTML
*CSS
*SCRIPT
*INDEX